namespace = BAT

character_event = { ##BATTLE OF STAMFORD BRIDGE (OR OTHER LOCATION)
	id = BAT.1
	title = TITLE_BAT1
	desc = DESC_BAT1
	picture = GFX_evt_cornered_duel_hf
	is_triggered_only = yes
	
	hide_from = yes
	
	immediate = {
		location = { save_global_event_target_as = 1066_foe_location } #for loc
		set_character_flag = spawned_bersker_1066
	}
	
	trigger = {
		start_date == 1066.9.15
		in_command = yes
		ROOT = { character = c_102531 } #Harald H책rdr책de
		OR = {
			FROM = { character = c_122 } #Harold Godwineson
			FROMFROM = { character = c_122 }
		}
		NOT = { has_character_flag = spawned_bersker_1066 }
	}
	
	option = {
		name = A_BAT1
		create_character = {
		    random_traits = no
			dynasty = random
			religion = ROOT
			culture = norwegian
			female = no
			health = 6

			attributes = {
				martial = 10
			}

			add_trait = tough_soldier
			add_trait = berserker
			add_trait = viking
			add_trait = strong
			add_trait = brave
			add_trait = scarred
		}
		new_character = {
			add_trait = agressive_leader
			add_artifact = axe_tier_2_new
			new_artifact = { set_name = "Dane Axe" }
			save_event_target_as = berseker_stamford
			random = {
				chance = 30
				ROOT = { character_event = { id = BAT.6 days = 3 } }
			}
		}
	}
}

character_event = {
	id = BAT.2
	title = TITLE_BAT2
	desc = DESC_BAT2
	picture = GFX_evt_diplomat_hf
	is_triggered_only = yes
	
	option = { #prisoner exchange
		name = A_BAT2
		piety = 20
		FROM = { character_event = { id = BAT.3 days = 5 } }
		ai_chance = { factor = 70 }
	}
	
	option = {
		name = B_BAT2
		random = {
			chance = 40
			add_trait = cynical
		}
		ai_chance = { factor = 30 }
	}
}

character_event = {
	id = BAT.3
	title = TITLE_BAT3
	desc = DESC_BAT3
	picture = GFX_evt_longbowman
	is_triggered_only = yes
	
	option = { #ambush
		name = A_BAT3
		FROM = {
			show_scope_change = no
			random_list = {
				75 = {
					character_event = { id = BAT.4 } #notify of death at battle
					death = {
						death_reason = death_battle
						killer = ROOT
					}
					c_124 = { #Tostig Godwineson
						death = {
							death_reason = death_battle
							killer = ROOT
						}
					}
				}
				25 = {
					character_event = { id = BAT.5 } #notify of survival
					modifier = {
						factor = 10
						FROM = { ai = no }
					}
				}
			}
		}
	}
}

character_event = {
	id = BAT.4
	title = TITLE_BAT4
	desc = DESC_BAT4
	picture = GFX_evt_longbowman
	is_triggered_only = yes
	
	option = {
		name = A_BAT4
	}
}

character_event = {
	id = BAT.5
	title = TITLE_BAT5
	desc = DESC_BAT5
	picture = GFX_evt_longbowman
	is_triggered_only = yes
	
	option = {
		name = A_BAT5
	}
}

character_event = {
	id = BAT.6
	title = TITLE_BAT6
	desc = DESC_BAT6
	picture = GFX_evt_duel_scene
	is_triggered_only = yes
	
	option = {
		name = A_BAT6
		event_target:berseker_stamford = {
			show_scope_change = no
			death = { death_reason = death_battle }
		}
	}
}

character_event = { #BATTLE OF HASTINGS
	id = BAT.7
	title = TITLE_BAT7
	desc = DESC_BAT7
	picture = GFX_evt_battle
	is_triggered_only = yes
	
	trigger = {
		character = c_140 #william
		FROM = { character = c_122 has_landed_title = k_england } #harold
		NOT = { FROM = { has_character_flag = hastings_survived } }
	}
	
	immediate = {
		location = { save_global_event_target_as = 1066_foe_location }
		set_character_flag = hastings_survived
	}
	
	option = {
		name = A_BAT7
		tooltip_info = martial
		random = {
			chance = 15
			change_martial = 1
		}
		FROM = { character_event = { id = BAT.8 } }
	}
}

character_event = {
	id = BAT.8
	title = TITLE_BAT8
	desc = DESC_BAT8
	picture = GFX_evt_battle
	is_triggered_only = yes
	
	option = { #leads to death
		name = A_BAT8
		FROM = { character_event = { id = BAT.9 } }
		ai_chance = { factor = 70 }
	}
	
	option = {
		name = B_BAT8
		set_character_flag = hastings_survived
		ai_chance = { factor = 30 }
	}
}

character_event = {
	id = BAT.9
	title = TITLE_BAT9
	desc = DESC_BAT9
	picture = GFX_evt_siege
	is_triggered_only = yes
	
	option = {
		name = A_BAT9
		random_list = {
			50 = {
				hidden_effect = {
					any_war = {
						limit = {
							war_title = k_england
							attacker = { character = ROOT }
						}
						end_war = success
					}
				}
				c_122 = {
					death = {
						death_reason = death_battle
						killer = ROOT
					}
					character_event = { id = BAT.10 }
				}
				c_130 = {
					death = {
						death_reason = death_battle
						killer = ROOT
					}
					character_event = { id = BAT.10 }
				}
				c_132 = {
					death = {
						death_reason = death_battle
						killer = ROOT
					}
					character_event = { id = BAT.10 }
				}
			}
			50 = {
				FROM = { character_event = { id = BAT.11 } }
			}
		}
	}
}

character_event = {
	id = BAT.10
	title = TITLE_BAT10
	desc = DESC_BAT10
	picture = GFX_evt_battle
	is_triggered_only = yes
	
	option = {
		name = A_BAT10
	}
}

character_event = {
	id = BAT.11
	title = TITLE_BAT11
	desc = DESC_BAT11
	picture = GFX_evt_battle
	is_triggered_only = yes
	
	option = {
		name = A_BAT11
		prestige = 100
		set_character_flag = hastings_survived
	}
}

character_event = {
	id = BAT.12
	title = TITLE_BAT12
	desc = DESC_BAT12
	picture = GFX_evt_diplomat_hf
	is_triggered_only = yes
	
	trigger = {
		FROM = { character = c_102531 } #Harald H책rdr책de
		ROOT = { character = c_122 } #Harold Godwineson
		NOT = { has_character_flag = prisoner_exchange }
	}
	
	immediate = {
		set_character_flag = prisoner_exchange
		location = { save_global_event_target_as = 1066_foe_location }
	}
	
	option = {
		name = A_BAT12
		prestige = -10
		FROM = { repeat_event = { id = BAT.2 } }
	}
	
	option = {
		name = B_BAT12
		remove_trait = kind
		ai_chance = { factor = 0 }
	}
}