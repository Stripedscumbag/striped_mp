namespace = FOE

##1066 "Fate of England" 1-20
##1066 Tostig's revenge 30-59

character_event = {
	id = FOE.1
	hide_window = yes
	is_triggered_only = yes
	
	trigger = {
		OR = {
			ROOT = { character = c_122 } #Godwinson
			ROOT = { character = c_140 } #William
		}
		FROM = { character = c_102531 } #H책rdr책de
	}
	
	immediate = {
		FROM = { narrative_event = { id = FOE.2 } }
	}
}

narrative_event = { #Norway Wins
	id = FOE.2
	title = TITLE_FOE2
	desc = DESC_FOE2
	picture = GFX_evt_viking_throneroom_oldgods
	is_triggered_only = yes
	
	trigger = {
		OR = {	
			FROM = { character = c_122 } #Godwinson
			FROM = { character = c_140 } #William
		}
		character = c_102531 #H책rdr책de
	}
	
	immediate = {
		if = {
			limit = {
				FROM = { character = c_140 }
			}
			k_england = { succession = feudal_elective }
		}
		add_trait = viking
		if = {
			limit = { # nicked the code from william's invasion
				ai = yes
			}
			d_bedford = {
				usurp_title_plus_barony_if_unlanded = { target = ROOT type = invasion }
				any_de_jure_vassal_title = {
					limit = {
						holder_scope = {
							culture = saxon
							ai = yes # But not from players
							same_realm = ROOT
						}
					}
					usurp_title_plus_barony_if_unlanded = { target = ROOT type = invasion }
				}
			}
			d_canterbury = {
				usurp_title_plus_barony_if_unlanded = { target = ROOT type = invasion }
				any_de_jure_vassal_title = {
					limit = {
						holder_scope = {
							culture = saxon
							ai = yes # But not from players
							same_realm = ROOT
						}
					}
					usurp_title_plus_barony_if_unlanded = { target = ROOT type = invasion }
				}
			}
			d_cornwall = {
				usurp_title_plus_barony_if_unlanded = { target = ROOT type = invasion }
				any_de_jure_vassal_title = {
					limit = {
						holder_scope = {
							culture = saxon
							ai = yes # But not from players
							same_realm = ROOT
						}
					}
					usurp_title_plus_barony_if_unlanded = { target = ROOT type = invasion }
				}
			}
			d_somerset = {
				usurp_title_plus_barony_if_unlanded = { target = ROOT type = invasion }
				any_de_jure_vassal_title = {
					limit = {
						holder_scope = {
							culture = saxon
							ai = yes # But not from players
							same_realm = ROOT
						}
					}
					usurp_title_plus_barony_if_unlanded = { target = ROOT type = invasion }
				}
			}
			d_gloucester = {
				usurp_title_plus_barony_if_unlanded = { target = ROOT type = invasion }
				any_de_jure_vassal_title = {
					limit = {
						holder_scope = {
							culture = saxon
							ai = yes # But not from players
							same_realm = ROOT
						}
					}
					usurp_title_plus_barony_if_unlanded = { target = ROOT type = invasion }
				}
			}
			d_norfolk = {
				usurp_title_plus_barony_if_unlanded = { target = ROOT type = invasion }
				any_de_jure_vassal_title = {
					limit = {
						holder_scope = {
							culture = saxon
							ai = yes # But not from players
							same_realm = ROOT
						}
					}
					usurp_title_plus_barony_if_unlanded = { target = ROOT type = invasion }
				}
			}
		}
	}
	
	option = { #Fullfill Tostig's wish
		name = A_FOE2
		prestige = 250
		
		c_124 = { #Tostig
			add_claim = k_england
			custom_tooltip = {
				text = TOSTIG_YORK
				ROOT = {
					any_demesne_title = {
						limit = {
							OR = {
								de_jure_liege_or_above = d_york
								de_jure_liege_or_above = d_cumbria
								de_jure_liege_or_above = d_northumberland
								de_jure_liege_or_above = c_lincoln
							}
						}
						gain_title = {
							target = c_124
							type = claim
						}
					}
				}
				d_york = {
					holder_scope = {
						any_demesne_title = {
							limit = {
								NOR = {
									de_jure_liege_or_above = d_hereford
									de_jure_liege_or_above = d_lancaster
								}
							}
							gain_title = {
								target = c_124
								type = claim
							}
						}
						c_lincoln = { #part of mercia but exlcuded above
							gain_title = {
								target = c_124
								type = claim
							}
						}
					}
				}
			}
		}
		ai_chance = { factor = 60 }
	}

	option = { #Fullfill Tostig's wish completely
		name = B_FOE2
		trigger = {
			NOT = {
				any_war = {
					any_attacker = { character = c_140 }
				}
			}
		}
		c_124 = { #Tostig
			
			custom_tooltip = {
				text = TOSTIG_COMPLETE
				k_england = {
					holder_scope = {
						any_demesne_title = {
							limit = {
								OR = {
									de_jure_liege_or_above = k_england
									de_jure_liege_or_above = d_cornwall
								}
							}
							gain_title = {
								target = c_124
								type = claim
							}
						}
					}
				}
				d_york = {
					holder_scope = {
						any_demesne_title = {
							limit = {
								OR = {
									de_jure_liege_or_above = d_york
									de_jure_liege_or_above = d_cumbria
									de_jure_liege_or_above = d_northumberland
									de_jure_liege_or_above = c_lincoln
								}
							}
							gain_title = {
								target = c_124
								type = claim
							}
						}
						c_lincoln = { #part of mercia but exlcuded above
							gain_title = {
								target = c_124
								type = claim
							}
						}
					}
				}
			}
		}
		ai_chance = { factor = 10 }
	}
	
	option = { #Fullfill Tostig's wish partially
		name = C_FOE2
		trigger = {
			NOT = { any_war = { using_unimportant_cb = yes } }
		}
		c_124 = { #Tostig
			
			custom_tooltip = {
				text = TOSTIG_PARTIAL
				k_england = {
					gain_title = {
						target = c_124
						type = grant
					}
				}
				k_norway = {
					any_vassal = {
						limit = {
							OR = {
								de_jure_liege_or_above = k_england
								de_jure_liege_or_above = d_cornwall
							}
						}
						set_defacto_liege = k_england
					}
				}
				d_york = {
					holder_scope = {
						any_demesne_title = {
							limit = {
								OR = {
									de_jure_liege_or_above = d_york
									de_jure_liege_or_above = d_cumbria
									de_jure_liege_or_above = d_northumberland
									de_jure_liege_or_above = c_lincoln
								}
							}
							gain_title = {
								target = c_124
								type = claim
							}
						}
						c_lincoln = { #part of mercia but exlcuded above
							gain_title = {
								target = c_124
								type = claim
							}
						}
					}
				}
			}
		}
		make_tributary = {
			who = c_124
			percentage = 0.7
		}
		ai_chance = { factor = 10 }
	}
	
	option = { #Don't fullfill Tostig's wish
		name = D_FOE2
		prestige = 500
		
		c_124 = { #Tostig
			add_claim = k_england
			add_rival = ROOT
			custom_tooltip = {
				text = TOSTIG_REVENGE #Will go around rulers asking for support to claim england
				k_denmark = {
					holder_scope = {
						c_124 = {
							banish = PREV
						}
					}
				}
				character_event = { id = FOE.30 }
			}
		}
		ai_chance = { factor = 40 }
	}
}

#England win
character_event = {
	id = FOE.3
	hide_window = yes
	is_triggered_only = yes
	
	trigger = {
		ROOT = { character = c_122 }
		OR = {
			FROM = { character = c_140 }
			FROM = { character = c_102531 }
		}
	}
	
	immediate = {
		repeat_event = { id = FOE.4 days = 1 }
	}
}
narrative_event = {
	id = FOE.4
	title = TITLE_FOE4
	desc = DESC_FOE4
	picture = GFX_evt_riders_night_hf
	is_triggered_only = yes
	
	trigger = {
		ROOT = { character = c_122 }
		OR = {
			FROM = { character = c_140 }
			FROM = { character = c_102531 }
		}
		war = no
	}
	
	sound = bloodline_added
	
	option = {
		name = A_FOE4
		give_nickname = nick_the_victorious
		prestige = 500
		create_bloodline = {
			type = harold_godwinson
		}
	}
}

character_event = { ##Tostig
	id = FOE.30
	hide_window = yes
	is_triggered_only = yes
	
	immediate = {
		employer = {
			character_event = { id = FOE.31 months = 1 }
		}
	}
}

character_event = {
	id = FOE.31
	title = TITLE_FOE31
	desc = DESC_FOE31
	#picture =
	is_triggered_only = yes
	
	option = { #accept Tostig's request
		name = A_FOE31
		opinion = {
			name = opinion_very_grateful
			who = FROM
		}
		character_event = { id = FOE.35 months = 2 }
		ai_chance = { factor = 10 }
	}
	
	option = { #decline Tostig's request
		name = B_FOE31
		k_sweden = {
			show_scope_change = no
			holder_scope = {
				show_scope_change = no
				c_124 = {
					banish = PREV
				}
			}
		}
		ai_chance = { factor = 30 }
	}
	
	option = { #accept Tostig's request under condition
		name = C_FOE31
		custom_tooltip = {
			text = TOSTIG_CONDITIONAL
			FROM = { character_event = { id = FOE.32 days = 7 } }
		}
		ai_chance = { factor = 50 }
	}
	
	option = {
		name = D_FOE31
		trigger = { trait = charitable }
		wealth = -100
		FROM = { wealth = 100 }
		opinion = {
			name = opinion_grateful
			who = FROM
		}
		k_sweden = {
			show_scope_change = no
			holder_scope = {
				show_scope_change = no
				c_124 = {
					banish = PREV
				}
			}
		}
	}
}

character_event = {
	id = FOE.32
	hide_window = yes
	is_triggered_only = yes
	
	immediate = {
		random_list = {
			6 = { #accept
				random_child = {
					if = {
						limit = { can_marry = no is_female = no }
						preferred_limit = { character = c_125 } #skuli
						remove_spouse = yes
						break_betrothal = yes
					}
					save_event_target_as = tostig_son_marriage
				}	
				FROM = { character_event = { id = FOE.33 days = 7 } }
			}
			1 = { #decline
				FROM = { character_event = { id = FOE.34 days = 7 } }
			}
		}
	}
}

character_event = {
	id = FOE.33
	title = TITLE_FOE33
	desc = DESC_FOE33
	#picture =
	is_triggered_only = yes
	
	option = {
		name = A_FOE33
		FROM = { set_character_flag = danish_support_con }
		if = {
			limit = { event_target:tostig_son_marriage = { age = 16 } }
			random_child = {
				show_scope_change = no
				limit = {
					is_female = yes
					age = 16
					can_marry = yes
				}
				add_spouse = event_target:tostig_son_marriage
			}
		}
		else = {
			random_child = {
				show_scope_change = no
				limit = {
					is_female = yes
					age < 16
					can_marry = yes
				}
				add_betrothal = event_target:tostig_son_marriage
			}
		}
		character_event = { id = FOE.35 months = 2 }
	}
}

character_event = {
	id = FOE.34
	title = TITLE_FOE34
	desc = DESC_FOE34
	#picture =
	is_triggered_only = yes
	
	option = {
		name = A_FOE34
	}
}

character_event = {
	id = FOE.35
	title = TITLE_FOE35
	desc = DESC_FOE35
	#picture =
	is_triggered_only = yes
	
	option = {
		name = A_FOE35
		random_courtier_or_vassal = {
			limit = { has_minor_title = title_commander }
			preferred_limit = { has_any_leadership_trait_trigger = no }
			remove_title = title_commander
		}
		FROM = { give_minor_title = title_commander }
		repeat_event = { id = FOE.36 months = 5 }
	}
}

character_event = {
	id = FOE.36
	title = TITLE_FOE36
	desc = DESC_FOE36
	#picture =
	is_triggered_only = yes
	
	option = {
		name = A_FOE36
		spawn_unit = {
			owner = ROOT
			province = capital
			leader = ROOT
			disband_on_peace = yes
			merge = yes
			
			troops = {
				archers = { 500 500 }
				light_infantry = { 750 750 }
				heavy_infantry = { 500 500 }
				light_cavalry = { 200 200 }
			}
		}
		spawn_unit = {
			owner = ROOT
			province = capital
			leader = FROM
			disband_on_peace = yes
			
			troops = {
				archers = { 500 500 }
				light_infantry = { 750 750 }
				heavy_infantry = { 500 500 }
				light_cavalry = { 200 200 }
			}
		}
		spawn_unit = {
			owner = ROOT
			province = capital
			
			disband_on_peace = yes
			
			troops = {
				archers = { 500 500 }
				light_infantry = { 1000 1000 }
				heavy_infantry = { 500 500 }
				light_cavalry = { 100 100 }
			}
		}
		spawn_fleet = {
			province = closest
			owner = ROOT
			disband_on_peace = yes

			troops = {
				galleys = { 30 30 }
			}
		}
		war = { ##not working????
			FROM = {
				target = k_england
				casus_belli = claim
				thirdparty_title = k_england
				thirdparty = ROOT
			}
		}
	}
}